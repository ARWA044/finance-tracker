 
{% load widget_tweaks %} 
{% load humanize %}
{% load static %}
{% load partials %}

    <div class=class="grid grid-cols-1 gap-4 md:grid-cols-4" id='transaction_container' >
        <div class="col-span-1 md:col-span-3">
            <h1 class='mb-3'>Totals</h1>
            <div class="stats shadow flex flex-wrap md:flex-nowrap gap-4 justify-center w-full mb-4">
                <div class="stat">
                    <div class="stat-figure text-secondary">
                        <i class="fa-solid fa-circle-dollar-to-slot"></i>
                    </div>
                    <div class="stat-title">Total Income</div>
                    <div class="stat-value">${{Totale_Income|floatformat:2|intcomma}}</div>
                    <div class="stat-desc"></div>
                </div>

                <div class="stat">
                    <div class="stat-figure text-secondary">
                        <i class="fa-solid fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-title">Total Expenses</div>
                    <div class="stat-value">${{Totale_Expense|floatformat:2|intcomma}}</div>
                    <div class="stat-desc"></div>
                </div>

                <div class="stat">
                    <div class="stat-figure text-secondary">
                        <i class="fa-solid fa-wallet"></i>
                    </div>
                    <div class="stat-title">Net Income</div>
                    <div class="stat-value">${{Net_income|floatformat:2|intcomma}}</div>
                    <div class="stat-desc"></div>
               </div>
            </div>
        </div>
        <div x-data="{ showFilter: false }" class="col-span-1 md:col-span-3">
        <div class=" flex justify-between mb-4" >
            <h1>Transactions</h1>
            <div class='flex item-center'>
            <a class='cursor-pointer mr-2'
            hx-get={%url 'export'%}
            hx-include="#filterform" >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                </svg>
            </a>
            <a class='cursor-pointer mr-2'
            hx-get={%url 'import'%}
            hx-target= "#transaction-block">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
                </svg>
            </a>
            <a hx-get={% url  'Add_Transactions'%}
               hx-target="#transaction-block"
               class='cursor-pointer'
            >
            <svg xmlns="http://www.w3.org/2000/svg" fill="green" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            </a>
            <button @click="showFilter = !showFilter"
              class="btn btn-sm btn-outline gap-2 text-white ml-2"
              title="Show Filters">
                <i class="fa-solid fa-filter"></i>
                Filter
            </button>
            </div>
        </div>
        <div x-show="showFilter"
            x-transition
            class="mb-4  p-4 rounded-box shadow grid grid-cols-1 md:grid-cols-4 gap-4">
            <form 
                hx-get="{% url 'Transactions' %}" 
                hx-target="#transaction_container"
                hx-swap="outerHTML"
                id="filterform"
                class="contents">

                <div class="form-control">
                    {{ filter.form.transaction_type|add_label_class:" mb-2" }}
                    {% render_field filter.form.transaction_type class="input text-black" %}
                </div>

                <div class="form-control">
                    {{ filter.form.start_date|add_label_class:" mb-2" }}
                    {% render_field filter.form.start_date class="input text-black" %}
                </div>

                <div class="form-control">
                    {{ filter.form.end_date|add_label_class:" mb-2" }}
                    {% render_field filter.form.end_date class="input text-black" %}
                </div>

                <div class="flex flex-wrap gap-2">
                    {% for checkbox in filter.form.category_type %}
                    <label
                        class="cursor-pointer rounded-full border px-3 py-1 select-none
                            hover:bg-blue-500 hover:text-white
                            {% if checkbox.data.checked %} bg-blue-600 text-white border-blue-600 {% else %} bg-white text-gray-700 {% endif %}"
                    >
                        {{ checkbox.tag }}
                        <span>{{ checkbox.choice_label }}</span>
                    </label>
                    {% endfor %}
                </div>

                <div class="form-control md:col-span-4">
                <button class="btn btn-primary w-full">Apply Filter</button>
                </div>
            </form>
        </div>
        </div>
        <div class="col-span-1 md:col-span-3" >
            {% if transactions %}
            <ul class="list bg-base-100 rounded-box shadow-md">
                <li class="p-4 pb-2 text-xs opacity-60 tracking-wide text-black">
                        Your recent transactions
                </li>
                {% partialdef transaction_list inline=True %}
                {% for item in transactions %}
                <li class="list-row flex items-center justify-between gap-4 p-3 border-t border-base-200 text-black">
                    <div class="flex items-center gap-4">
                    <div><i class="{{item.category.icon}}" ></i></div>
                    <div>
                        <div>{{item.category.name}}</div>
                        <div class="text-xs uppercase font-semibold opacity-60">
                            ${{item.amount}} â€” {{ item.type }}</div>
                        <div class="text-xs opacity-50">
                              {{ item.time}}
                        </div>
                    </div>
                    </div>
                    <div class='flex item-center  '>
                    <a hx-get={% url 'update_transaction' item.pk %}
                        hx-target='#transaction-block'
                        class='cursor-pointer' >
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />
                        </svg>
                    </a>
                    <a hx-delete={% url 'delete_transaction' item.pk %}
                        hx-target='#transaction-block'
                        hx-confirm="Are you sure you wish to delete this transaction ?"
                        class='cursor-pointer'>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                        </svg>
                    </a>
                    </div>
                </li>
                {% if forloop.last and transactions.has_next %}
                <li
                    hx-get="{% url 'get_transaction' %}?page={{ transactions.next_page_number }}"
                    hx-trigger="revealed"
                    hx-swap="afterend"
                    hx-indicator="#spinner">
                </li>
                {% endif %}
                {% endfor %} 
                {% endpartialdef %}  

            </ul>
            {%else%}
                <p>No Transactions Found</p>
            {% endif %}
        </div> 
    </div>